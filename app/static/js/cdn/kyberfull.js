/* esm.sh - esbuild bundle(crystals-kyber-js@1.1.1) es2021 production */
var w=class extends Error{constructor(e){let s;e instanceof Error?s=e.message:typeof e=="string"?s=e:s="",super(s),this.name=this.constructor.name}};var U=[2285,2571,2970,1812,1493,1422,287,202,3158,622,1577,182,962,2127,1855,1468,573,2004,264,383,2500,1458,1727,3199,2648,1017,732,608,1787,411,3124,1758,1223,652,2777,1015,2036,1491,3047,1785,516,3321,3009,2663,1711,2167,126,1469,2476,3239,3058,830,107,1908,3082,2378,2931,961,1821,2604,448,2264,677,2054,2226,430,555,843,2078,871,1550,105,422,587,177,3094,3038,2869,1574,1653,3083,778,1159,3182,2552,1483,2727,1119,1739,644,2457,349,418,329,3173,3254,817,1097,603,610,1322,2044,1864,384,2114,3193,1218,1994,2455,220,2142,1670,2144,1799,2051,794,1819,2475,2459,478,3221,3021,996,991,958,1869,1522,1628],N=[1701,1807,1460,2371,2338,2333,308,108,2851,870,854,1510,2535,1278,1530,1185,1659,1187,3109,874,1335,2111,136,1215,2945,1465,1285,2007,2719,2726,2232,2512,75,156,3e3,2911,2980,872,2685,1590,2210,602,1846,777,147,2170,2551,246,1676,1755,460,291,235,3152,2742,2907,3224,1779,2458,1251,2486,2774,2899,1103,1275,2652,1065,2881,725,1508,2368,398,951,247,1421,3222,2499,271,90,853,1860,3203,1162,1618,666,320,8,2813,1544,282,1838,1293,2314,552,2677,2106,1571,205,2918,1542,2721,2597,2312,681,130,1602,1871,829,2946,3065,1325,2756,1861,1474,1202,2367,3147,1752,2707,171,3127,3042,1907,1836,1517,359,758,1441];import{sha3_256 as se,sha3_512 as ne,shake128 as oe,shake256 as ue}from"./sha3.js";var $={},C=ee(globalThis,$);function ee(i,e){return new Proxy(i,{get(s,t,r){return t in e?e[t]:i[t]},set(s,t,r){return t in e&&delete e[t],i[t]=r,!0},deleteProperty(s,t){let r=!1;return t in e&&(delete e[t],r=!0),t in i&&(delete i[t],r=!0),r},ownKeys(s){let t=Reflect.ownKeys(i),r=Reflect.ownKeys(e),n=new Set(r);return[...t.filter(o=>!n.has(o)),...r]},defineProperty(s,t,r){return t in e&&delete e[t],Reflect.defineProperty(i,t,r),!0},getOwnPropertyDescriptor(s,t){return t in e?Reflect.getOwnPropertyDescriptor(e,t):Reflect.getOwnPropertyDescriptor(i,t)},has(s,t){return t in e||t in i}})}import{shake256 as re}from"./sha3.js";function f(i){return i%256}function d(i){return i>=-32768&&i<=32767?i:i<-32768?(i=i+32769,i=i%65536,32767+i):(i=i-32768,i=i%65536,-32768+i)}function a(i){return i%65536}function T(i){return i>=-2147483648&&i<=2147483647?i:i<-2147483648?(i=i+2147483649,i=i%4294967296,2147483647+i):(i=i-2147483648,i=i%4294967296,-2147483648+i)}function y(i){return i%4294967296}function O(i,e){if(i.length!=e.length)return 0;let s=new Uint8Array([0]);for(let r=0;r<i.length;r++)s[0]|=i[r]^e[r];let t=new Uint8Array([0]);return t[0]=~(s[0]^t[0]),t[0]&=t[0]>>4,t[0]&=t[0]>>2,t[0]&=t[0]>>1,t[0]}async function R(){if(C!==void 0&&globalThis.crypto!==void 0)return globalThis.crypto;try{let{webcrypto:i}=await import("/v135/crypto-browserify@3.12.0/es2021/crypto-browserify.mjs");return i}catch{throw new Error("failed to load Crypto")}}function A(i,e,s){return re.create({dkLen:i}).update(e).update(new Uint8Array([s])).digest()}function I(i){let e=y(i[0]);return e|=y(i[1])<<8,e|=y(i[2])<<16,e}function Q(i){let e=y(i[0]);return e|=y(i[1])<<8,e|=y(i[2])<<16,e|=y(i[3])<<24,y(e)}var g=class{constructor(){Object.defineProperty(this,"_api",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_skSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_pkSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_compressedUSize",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_compressedVSize",{enumerable:!0,configurable:!0,writable:!0,value:0})}async generateKeyPair(){await this._setup();try{let e=new Uint8Array(64);return this._api.getRandomValues(e),this._deriveKeyPair(e)}catch(e){throw new w(e)}}async deriveKeyPair(e){await this._setup();try{if(e.byteLength!==64)throw new Error("seed must be 64 bytes in length");return this._deriveKeyPair(e)}catch(s){throw new w(s)}}async encap(e,s){await this._setup();try{let t=v(this._getSeed(s)),[r,n]=K(t,v(e)),o=this._encap(e,t,n),u=V(r,v(o));return[o,u]}catch(t){throw new w(t)}}async decap(e,s){await this._setup();try{if(e.byteLength!==this._compressedUSize+this._compressedVSize)throw new Error("Invalid ct size");let t=s.subarray(0,this._skSize),r=s.subarray(this._skSize,this._skSize+this._pkSize),n=s.subarray(this._skSize+this._pkSize,this._skSize+this._pkSize+32),o=s.subarray(this._skSize+this._pkSize+32,this._skSize+this._pkSize+64),u=this._decap(e,t),[p,b]=K(u,n),c=this._encap(r,u,b);return O(e,c)==1?V(p,v(e)):V(o,v(e))}catch(t){throw new w(t)}}async _setup(){this._api===void 0&&(this._api=await R())}_getSeed(e){if(e==null){let s=new Uint8Array(32);return this._api.getRandomValues(s),s}if(e.byteLength!==32)throw new Error("seed must be 32 bytes in length");return e}_deriveKeyPair(e){let s=e.subarray(0,32),t=e.subarray(32,64),[r,n]=this._deriveCpaKeyPair(s),o=v(r),u=new Uint8Array(this._skSize+this._pkSize+64);return u.set(n,0),u.set(r,this._skSize),u.set(o,this._skSize+this._pkSize),u.set(t,this._skSize+this._pkSize+32),[r,u]}_deriveCpaKeyPair(e){let[s,t]=K(e),r=this._sampleMatrix(s,!1),n=this._sampleNoise1(t,0,this._k),o=this._sampleNoise1(t,this._k,this._k);for(let c=0;c<this._k;c++)n[c]=j(n[c]),n[c]=S(n[c]),o[c]=j(o[c]);let u=new Array(this._k);for(let c=0;c<this._k;c++)u[c]=fe(F(r[c],n)),u[c]=P(u[c],o[c]),u[c]=S(u[c]);let p=new Uint8Array(this._pkSize);for(let c=0;c<this._k;c++)p.set(Z(u[c]),c*384);p.set(s,this._skSize);let b=new Uint8Array(this._skSize);for(let c=0;c<this._k;c++)b.set(Z(n[c]),c*384);return[p,b]}_encap(e,s,t){let r=new Array(this._k);for(let h=0;h<this._k;h++)r[h]=D(e.subarray(h*384,(h+1)*384));let n=e.subarray(this._skSize),o=this._sampleMatrix(n,!0),u=this._sampleNoise1(t,0,this._k),p=this._sampleNoise2(t,this._k,this._k),b=this._sampleNoise2(t,this._k*2,1)[0];for(let h=0;h<this._k;h++)u[h]=j(u[h]),u[h]=S(u[h]);let c=new Array(this._k);for(let h=0;h<this._k;h++)c[h]=F(o[h],u),c[h]=M(c[h]),c[h]=P(c[h],p[h]),c[h]=S(c[h]);let x=le(s),m=F(r,u);m=M(m),m=P(m,b),m=P(m,x),m=S(m);let z=new Uint8Array(this._compressedUSize+this._compressedVSize);return this._compressU(z.subarray(0,this._compressedUSize),c),this._compressV(z.subarray(this._compressedUSize),m),z}_decap(e,s){let t=this._decompressU(e.subarray(0,this._compressedUSize)),r=this._decompressV(e.subarray(this._compressedUSize)),n=this._polyvecFromBytes(s);for(let u=0;u<this._k;u++)t[u]=j(t[u]);let o=F(n,t);return o=M(o),o=he(r,o),o=S(o),ce(o)}_sampleMatrix(e,s){let t=new Array(this._k),r=new Uint8Array(2);for(let n=0,o=0;o<this._k;o++){t[o]=new Array(this._k);for(let u=0;u<this._k;u++){s?(r[0]=o,r[1]=u):(r[0]=u,r[1]=o);let p=ae(e,r),b=G(p.subarray(0,504),504,256);for(t[o][u]=b[0],n=b[1];n<256;){let c=p.subarray(504,672),x=G(c,168,256-n),m=x[0],z=x[1];for(let h=n;h<256;h++)t[o][u][h]=m[h-n];n=n+z}}}return t}_sampleNoise1(e,s,t){let r=new Array(t);for(let n=0;n<t;n++)r[n]=q(A(this._eta1*256/4,e,s),this._eta1),s++;return r}_sampleNoise2(e,s,t){let r=new Array(t);for(let n=0;n<t;n++)r[n]=q(A(this._eta2*256/4,e,s),this._eta2),s++;return r}_polyvecFromBytes(e){let s=new Array(this._k);for(let t=0;t<this._k;t++)s[t]=D(e.subarray(t*384,(t+1)*384));return s}_compressU(e,s){let t=new Array(4);for(let r=0,n=0;n<this._k;n++)for(let o=0;o<256/4;o++){for(let u=0;u<4;u++)t[u]=((s[n][4*o+u]<<10)+3329/2)/3329&1023;e[r++]=f(t[0]>>0),e[r++]=f(t[0]>>8|t[1]<<2),e[r++]=f(t[1]>>6|t[2]<<4),e[r++]=f(t[2]>>4|t[3]<<6),e[r++]=f(t[3]>>2)}return e}_compressV(e,s){let t=new Uint8Array(8);for(let r=0,n=0;n<256/8;n++){for(let o=0;o<8;o++)t[o]=f(((s[8*n+o]<<4)+3329/2)/3329)&15;e[r++]=t[0]|t[1]<<4,e[r++]=t[2]|t[3]<<4,e[r++]=t[4]|t[5]<<4,e[r++]=t[6]|t[7]<<4}return e}_decompressU(e){let s=new Array(this._k);for(let r=0;r<this._k;r++)s[r]=new Array(384);let t=new Array(4);for(let r=0,n=0;n<this._k;n++)for(let o=0;o<256/4;o++){t[0]=a(e[r+0])>>0|a(e[r+1])<<8,t[1]=a(e[r+1])>>2|a(e[r+2])<<6,t[2]=a(e[r+2])>>4|a(e[r+3])<<4,t[3]=a(e[r+3])>>6|a(e[r+4])<<2,r=r+5;for(let u=0;u<4;u++)s[n][4*o+u]=d(y(t[u]&1023)*y(3329)+512>>10)}return s}_decompressV(e){let s=new Array(384);for(let t=0,r=0;r<256/2;r++,t++)s[2*r+0]=d(a(e[t]&15)*a(3329)+8>>4),s[2*r+1]=d(a(e[t]>>4)*a(3329)+8>>4);return s}};function K(i,e){let s=ne.create().update(i);e!==void 0&&s.update(e);let t=s.digest();return[t.subarray(0,32),t.subarray(32,64)]}function v(i){return se.create().update(i).digest()}function V(i,e){let s=ue.create({dkLen:32}).update(i);return e!==void 0&&s.update(e),s.digest()}function ae(i,e){return oe.create({dkLen:672}).update(i).update(e).digest()}function Z(i){let e=0,s=0,t=new Uint8Array(384),r=Y(i);for(let n=0;n<256/2;n++)e=a(r[2*n]),s=a(r[2*n+1]),t[3*n+0]=f(e>>0),t[3*n+1]=f(e>>8)|f(s<<4),t[3*n+2]=f(s>>4);return t}function D(i){let e=new Array(384).fill(0);for(let s=0;s<256/2;s++)e[2*s]=d((a(i[3*s+0])>>0|a(i[3*s+1])<<8)&4095),e[2*s+1]=d((a(i[3*s+1])>>4|a(i[3*s+2])<<4)&4095);return e}function ce(i){let e=new Uint8Array(32),s,t=Y(i);for(let r=0;r<256/8;r++){e[r]=0;for(let n=0;n<8;n++)s=((a(t[8*r+n])<<1)+a(3329/2))/a(3329)&1,e[r]|=f(s<<n)}return e}function le(i){let e=new Array(384).fill(0),s;for(let t=0;t<256/8;t++)for(let r=0;r<8;r++)s=-1*d(i[t]>>r&1),e[8*t+r]=s&d(3330/2);return e}function G(i,e,s){let t=new Array(384).fill(0),r=0,n,o;for(let u=0;r<s&&u+3<=e;)n=(a(i[u]>>0)|a(i[u+1])<<8)&4095,o=(a(i[u+1]>>4)|a(i[u+2])<<4)&4095,u=u+3,n<3329&&(t[r]=n,r=r+1),r<s&&o<3329&&(t[r]=o,r=r+1);return[t,r]}function q(i,e){let s,t,r,n,o=new Array(384).fill(0);for(let u=0;u<256/8;u++){s=Q(i.subarray(4*u,i.length)),t=s&1431655765,t=t+(s>>1&1431655765);for(let p=0;p<8;p++)r=d(t>>4*p+0&3),n=d(t>>4*p+e&3),o[8*u+p]=r-n}return o}function j(i){for(let e=0,s=1,t=128;t>=2;t>>=1)for(let r=0;r<256;r=e+t){let n=U[s];for(s=s+1,e=r;e<r+t;e++){let o=k(n,i[e+t]);i[e+t]=i[e]-o,i[e]=i[e]+o}}return i}function k(i,e){return X(i*e)}function S(i){for(let e=0;e<256;e++)i[e]=W(i[e]);return i}function W(i){let s=(16777216+3329/2)/3329*i>>24;return s=s*3329,i-s}function X(i){let s=d(T(i)*62209)*3329;return s=i-s,s>>=16,d(s)}function fe(i){for(let s=0;s<256;s++)i[s]=X(T(i[s])*T(1353));return i}function F(i,e){let s=H(i[0],e[0]),t;for(let r=1;r<i.length;r++)t=H(i[r],e[r]),s=P(s,t);return S(s)}function H(i,e){let s,t;for(let r=0;r<256/4;r++)s=J(i[4*r+0],i[4*r+1],e[4*r+0],e[4*r+1],U[64+r]),t=J(i[4*r+2],i[4*r+3],e[4*r+2],e[4*r+3],-U[64+r]),i[4*r+0]=s[0],i[4*r+1]=s[1],i[4*r+2]=t[0],i[4*r+3]=t[1];return i}function J(i,e,s,t,r){let n=new Array(2);return n[0]=k(e,t),n[0]=k(n[0],r),n[0]+=k(i,s),n[1]=k(i,t),n[1]+=k(e,s),n}function P(i,e){let s=new Array(384);for(let t=0;t<256;t++)s[t]=i[t]+e[t];return s}function he(i,e){for(let s=0;s<256;s++)i[s]-=e[s];return i}function M(i){let e=0;for(let s=0,t=2;t<=128;t<<=1)for(let r=0;r<256;r=e+t){let n=N[s];for(s=s+1,e=r;e<r+t;e++){let o=i[e];i[e]=W(o+i[e+t]),i[e+t]=o-i[e+t],i[e+t]=k(n,i[e+t])}}for(e=0;e<256;e++)i[e]=k(i[e],N[127]);return i}function Y(i){for(let e=0;e<256;e++)i[e]-=3329,i[e]+=i[e]>>31&3329;return i}var B=class extends g{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}_sampleNoise1(e,s,t){let r=new Array(t);for(let n=0;n<t;n++)r[n]=_e(A(this._eta1*256/4,e,s),this._eta1),s++;return r}};function _e(i,e){let s,t,r,n,o=new Array(384).fill(0);for(let u=0;u<256/4;u++){s=I(i.subarray(3*u,i.length)),t=s&2396745,t=t+(s>>1&2396745),t=t+(s>>2&2396745);for(let p=0;p<4;p++)r=d(t>>6*p+0&7),n=d(t>>6*p+e&7),o[4*u+p]=r-n}return o}var E=class extends g{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}};var L=class extends g{constructor(){super(),Object.defineProperty(this,"_k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"_du",{enumerable:!0,configurable:!0,writable:!0,value:11}),Object.defineProperty(this,"_dv",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_eta1",{enumerable:!0,configurable:!0,writable:!0,value:2}),Object.defineProperty(this,"_eta2",{enumerable:!0,configurable:!0,writable:!0,value:2}),this._skSize=12*this._k*256/8,this._pkSize=this._skSize+32,this._compressedUSize=this._k*this._du*256/8,this._compressedVSize=this._dv*256/8}_compressU(e,s){let t=new Array(8);for(let r=0,n=0;n<this._k;n++)for(let o=0;o<256/8;o++){for(let u=0;u<8;u++)t[u]=a(((y(s[n][8*o+u])<<11)+y(3329/2))/y(3329)&2047);e[r++]=f(t[0]>>0),e[r++]=f(t[0]>>8|t[1]<<3),e[r++]=f(t[1]>>5|t[2]<<6),e[r++]=f(t[2]>>2),e[r++]=f(t[2]>>10|t[3]<<1),e[r++]=f(t[3]>>7|t[4]<<4),e[r++]=f(t[4]>>4|t[5]<<7),e[r++]=f(t[5]>>1),e[r++]=f(t[5]>>9|t[6]<<2),e[r++]=f(t[6]>>6|t[7]<<5),e[r++]=f(t[7]>>3)}return e}_compressV(e,s){let t=new Uint8Array(8);for(let r=0,n=0;n<256/8;n++){for(let o=0;o<8;o++)t[o]=f(((y(s[8*n+o])<<5)+y(3329/2))/y(3329))&31;e[r++]=f(t[0]>>0|t[1]<<5),e[r++]=f(t[1]>>3|t[2]<<2|t[3]<<7),e[r++]=f(t[3]>>1|t[4]<<4),e[r++]=f(t[4]>>4|t[5]<<1|t[6]<<6),e[r++]=f(t[6]>>2|t[7]<<3)}return e}_decompressU(e){let s=new Array(this._k);for(let r=0;r<this._k;r++)s[r]=new Array(384);let t=new Array(8);for(let r=0,n=0;n<this._k;n++)for(let o=0;o<256/8;o++){t[0]=a(e[r+0])>>0|a(e[r+1])<<8,t[1]=a(e[r+1])>>3|a(e[r+2])<<5,t[2]=a(e[r+2])>>6|a(e[r+3])<<2|a(e[r+4])<<10,t[3]=a(e[r+4])>>1|a(e[r+5])<<7,t[4]=a(e[r+5])>>4|a(e[r+6])<<4,t[5]=a(e[r+6])>>7|a(e[r+7])<<1|a(e[r+8])<<9,t[6]=a(e[r+8])>>2|a(e[r+9])<<6,t[7]=a(e[r+9])>>5|a(e[r+10])<<3,r=r+11;for(let u=0;u<8;u++)s[n][8*o+u]=y(t[u]&2047)*3329+1024>>11}return s}_decompressV(e){let s=new Array(384),t=new Array(8);for(let r=0,n=0;n<256/8;n++){t[0]=e[r+0]>>0,t[1]=e[r+0]>>5|e[r+1]<<3,t[2]=e[r+1]>>2,t[3]=e[r+1]>>7|e[r+2]<<1,t[4]=e[r+2]>>4|e[r+3]<<4,t[5]=e[r+3]>>1,t[6]=e[r+3]>>6|e[r+4]<<2,t[7]=e[r+4]>>3,r=r+5;for(let o=0;o<8;o++)s[8*n+o]=d(y(t[o]&31)*y(3329)+16>>5)}return s}};export{L as Kyber1024,B as Kyber512,E as Kyber768,w as KyberError};
//# sourceMappingURL=crystals-kyber-js.mjs.map